

**`git status`命令可以让我们时刻掌握仓库当前的状态**



**需要用`git diff`这个命令看看上次怎么修改**

`git diff`顾名思义就是查看difference，显示的格式正是Unix通用的diff格式，



## 版本回退



**版本控制系统肯定有某个命令可以告诉我们历史记录，在Git中，我们用`git log`命令查看：**

`git log`命令显示从最近到最远的提交日志，如果嫌输出信息太多，看得眼花缭乱的，可以试试加上

`--pretty=oneline`参数：



Git的`commit id`不是1，2，3……递增的数字，而是一个SHA1计算出来的一个非常大的数字，用十六进制表示

每提交一个新版本，实际上Git就会把它们自动串成一条时间线。如果使用可视化工具查看Git历史，就可以更清楚地看到提交历史的时间线：



在Git中，用`HEAD`表示当前版本，也就是最新的提交

上一个版本就是`HEAD^`，上上一个版本就是`HEAD^^`，当然往上100个版本写100个`^`比较容易数不过来，所以写成`HEAD~100`。

使用`git reset`命令回退到上一个版本

```c
$ git reset --hard HEAD^
```

那回到现在怎么办，找到版本号，用前几位

```
$ git reset --hard 1094a //1094a版本号前几位，不一定一致
```

Git的版本回退速度非常快，因为Git在内部有个指向当前版本的`HEAD`指针，当你回退版本的时候，只是指针变化

然后顺便把工作区的文件更新了。所以你让`HEAD`指向哪个版本号，你就把当前版本定位在哪。



如果找不到版本号，也是有后悔的方法的。

Git提供了一个命令`git reflog`用来记录你的每一次命令：



## 工作区和暂存区

 

#### 工作区（Working Directory）

就是你在电脑里能看到的目录

#### 版本库（Repository）

工作区有一个隐藏目录`.git`，这个不算工作区，而是Git的版本库。

Git的版本库里存了很多东西，其中最重要的就是称为stage（或者叫index）的暂存区，还有Git为我们自动创建的第一个分支`master`，以及指向`master`的一个指针叫`HEAD`。

![git-repo](https://www.liaoxuefeng.com/files/attachments/919020037470528/0)

第一步是用`git add`把文件添加进去，实际上就是把文件修改添加到暂存区；

第二步是用`git commit`提交更改，实际上就是把暂存区的所有内容提交到当前分支。



因为我们创建Git版本库时，Git自动为我们创建了唯一一个`master`分支，所以，现在，`git commit`就是往`master`分支上提交更改。

你可以简单理解为，需要提交的文件修改通通放到暂存区，然后，一次性提交暂存区的所有修改。



从来没有被添加过的状态是`Untracked`。



一旦提交后，如果你又没有对工作区做任何修改，那么工作区就是“干净”的：



## 管理修改

Git比其他版本控制系统设计得优秀，因为Git跟踪并管理的是修改，而非文件。

每次修改，如果不用`git add`到暂存区，那就不会加入到`commit`中。

## 撤销修改

### 工作区的修改

`git checkout -- file`可以丢弃工作区的修改：

命令`git checkout -- readme.txt`意思就是，把`readme.txt`文件在工作区的修改全部撤销，这里有两种情况：

一种是`readme.txt`自修改后还没有被放到暂存区，现在，撤销修改就回到和版本库一模一样的状态；

一种是`readme.txt`已经添加到暂存区后，又作了修改，现在，撤销修改就回到添加到暂存区后的状态。

总之，就是让这个文件回到最近一次`git commit`或`git add`时的状态。

`git checkout -- file`命令中的`--`很重要，没有`--`，就变成了“切换到另一个分支”的命令



### 暂存区的修改

Git同样告诉我们，用命令`git reset HEAD <file>`可以把暂存区的修改撤销掉（unstage），重新放回工作区：

`git reset`命令既可以回退版本，也可以把暂存区的修改回退到工作区。当我们用`HEAD`时，表示最新的版本。

然后再丢弃工作区的修改



如果暂存区提交到了版本库，怎么办呢？[版本回退]。但推到远程版本库就凉凉了。

## 删除文件

一般情况下，你通常直接在文件管理器中把没用的文件删了，或者用`rm`命令删了：

这个时候，Git知道你删除了文件，因此，工作区和版本库就不一致了，`git status`命令会立刻告诉你哪些文件被删除了：

现在你有两个选择，



一是确实要从版本库中删除该文件，那就用命令`git rm`删掉，并且`git commit`：

先手动删除文件，然后使用`git rm <file>`和`git add<file>`效果是一样的。



另一种情况是删错了，因为版本库里还有呢，所以可以很轻松地把误删的文件恢复到最新版本：

`git checkout`其实是用版本库里的版本替换工作区的版本，无论工作区是修改还是删除，都可以“一键还原”。

 注意：从来没有被添加到版本库就被删除的文件，是无法恢复的！